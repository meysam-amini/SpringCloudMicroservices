Steps to Set Up the Docker Registry:
1.Pull the Docker Registry Image:
docker pull registry:2
2.Start the Docker Registry Container:
docker run -d -p 5000:5000 --name my-registry registry:2
3.Push and Pull Images: Tag an image to point to your registry, then push it:
docker tag my-image <server-ip>:5000/my-image
docker push <server-ip>:5000/my-image
Pulling the image from your registry would be:
docker pull <server-ip>:5000/my-image

//////////////////////////////////add custom images///////////////////////////////////
dockerFile1(Build a custom Maven image based on Java 21 for building the Spring Boot project):
FROM maven:3.9.9-amazoncorretto-21-alpine
WORKDIR /app

Build and push it to the registry:
docker build -t localhost:5000/custom-maven:latest .
docker push localhost:5000/custom-maven:latest

dockerFile2(Build a custom Java runtime image):
FROM amazoncorretto:21
WORKDIR /app

Build and push it to the registry:
docker build -t localhost:5000/custom-java:latest .
docker push localhost:5000/custom-java:latest

script:
#!/bin/bash

# Define registry and image names
REGISTRY="localhost:5000"
MAVEN_IMAGE_NAME="custom-maven"
JAVA_IMAGE_NAME="custom-java"

# Step 1: Build custom Maven image for building the Spring Boot project
echo "Building custom Maven image..."
cat > Dockerfile_maven <<EOF
FROM maven:3.9.9-amazoncorretto-21-alpine
WORKDIR /app
EOF

docker build -t $REGISTRY/$MAVEN_IMAGE_NAME:latest -f Dockerfile_maven .
docker push $REGISTRY/$MAVEN_IMAGE_NAME:latest
rm Dockerfile_maven
echo "Custom Maven image built and pushed to $REGISTRY/$MAVEN_IMAGE_NAME:latest."

# Step 2: Build custom Java runtime image
echo "Building custom Java runtime image..."
cat > Dockerfile_java <<EOF
FROM amazoncorretto:21
WORKDIR /app
EOF

docker build -t $REGISTRY/$JAVA_IMAGE_NAME:latest -f Dockerfile_java .
docker push $REGISTRY/$JAVA_IMAGE_NAME:latest
rm Dockerfile_java
echo "Custom Java runtime image built and pushed to $REGISTRY/$JAVA_IMAGE_NAME:latest."

echo "All images have been built and pushed to the registry."


//////////////////////////////////////////////////////////////////////////////////////

4.Secure Your Registry with Authentication and TLS, and Configure Docker Daemon to Trust Your Registry
4.1.Install NGINX on Your Server
sudo apt install nginx -y
4.2.Set Up SSL Certificates:
Option 1: Generate a Self-Signed Certificate
Option 2: Use Let’s Encrypt (if you have a domain)

4.2.1.Generate a Self-Signed Certificate
sudo mkdir -p /etc/nginx/certs
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/certs/registry.key -out /etc/nginx/certs/registry.crt
4.3.Configure Basic Authentication
sudo apt install apache2-utils -y
sudo htpasswd -c /etc/nginx/.htpasswd myuser
//This will prompt you to enter a password for myuser. You can add more users by running htpasswd /etc/nginx/.htpasswd otheruser.

5.Configure NGINX for Docker Registry
Create an NGINX configuration for the Docker Registry:
sudo nano /etc/nginx/sites-available/docker-registry
Add the following configuration:

server {
    listen 443 ssl;
    #server_name your-domain.com; # or use _ if no domain
    #server_name _;

    ssl_certificate /etc/nginx/certs/registry.crt;
    ssl_certificate_key /etc/nginx/certs/registry.key;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Basic authentication
        auth_basic "Docker Registry";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
}

6.Enable the Configuration and Restart NGINX
Link the configuration file and restart NGINX:
sudo ln -s /etc/nginx/sites-available/docker-registry /etc/nginx/sites-enabled/

note:
////////////////
Symbolic Link (ln -s): Creates a shortcut, meaning if you update the file in sites-available, those changes immediately apply in sites-enabled because both paths point to the same file.
                Copying (cp): Creates a separate file in sites-enabled, which means if you update the file in sites-available, you would need to copy it again to apply the changes in sites-enabled.
///////////////
sudo nginx -t
note:
///////////////
tests the NGINX configuration files for syntax errors and potential issues without actually reloading or restarting the NGINX service.
//////////////
sudo systemctl restart nginx

7.Update Docker Clients to Use the Registry
 If you’re using self-signed certificates, add the registry as an
 insecure registry on each client machine. Update the Docker daemon’s
 configuration on each client at /etc/docker/daemon.json: